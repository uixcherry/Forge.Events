# Forge.Events - Плагин событий для Unturned RocketMod

## Содержание
- [Описание](#описание)
- [Основные возможности](#основные-возможности)
- [Установка](#установка)
- [Конфигурация](#конфигурация)
  - [Основные настройки](#основные-настройки)
  - [Сообщения](#сообщения)
  - [Ящики событий](#ящики-событий)
  - [Локации событий](#локации-событий)
  - [Цвета редкости](#цвета-редкости)
- [Команды плагина](#команды-плагина)
- [Механика работы](#механика-работы)
- [Примеры использования](#примеры-использования)
- [Устранение проблем](#устранение-проблем)

## Описание

Forge.Events - плагин для Unturned RocketMod, добавляющий на сервер периодические события с ящиками, которые содержат различные предметы. Игроки могут соревноваться за право первыми открыть ящик. Плагин предназначен для добавления динамичности на сервер и поощрения PvP активности.

## Основные возможности

- Автоматическое создание случайных событий по всей карте
- Настраиваемые локации для спавна ящиков
- Разные типы ящиков с различной редкостью и наградами
- Таймер обратного отсчета при активации ящика
- Настраиваемые предметы и шансы их выпадения
- Защита зоны события от строительства до завершения
- Система уведомлений игроков о событиях

## Установка

1. Скачайте плагин из [releases](https://github.com/yourusername/Forge.Events/releases)
2. Поместите скачанный .dll файл в папку `/Rocket/Plugins/` на вашем сервере Unturned
3. Перезапустите сервер или используйте команду `/reload` для загрузки плагина
4. После первого запуска будет создан файл конфигурации, который можно настроить

## Конфигурация

Файл конфигурации находится в `Rocket/Plugins/Forge.Events.configuration.xml`. Ниже приведено подробное описание всех параметров.

### Основные настройки

```xml
<IsEnabled>true</IsEnabled>
<EventIntervalMinutes>60</EventIntervalMinutes>
<MinPlayersForEvent>12</MinPlayersForEvent>
<CountdownTimerSeconds>60</CountdownTimerSeconds>
<MinDistanceFromBuildables>15</MinDistanceFromBuildables>
<MinDistanceFromWater>5</MinDistanceFromWater>
<MaxSlopeAngle>25</MaxSlopeAngle>
<NoBuildsAroundEventBoxRadius>25</NoBuildsAroundEventBoxRadius>
```

| Параметр | Описание |
|----------|----------|
| `IsEnabled` | Включение/выключение автоматических событий (`true`/`false`) |
| `EventIntervalMinutes` | Интервал между событиями в минутах |
| `MinPlayersForEvent` | Минимальное количество игроков на сервере для активации события |
| `CountdownTimerSeconds` | Время обратного отсчета при активации ящика в секундах |
| `MinDistanceFromBuildables` | Минимальное расстояние от построек для спавна ящика (не используется при ручном размещении локаций) |
| `MinDistanceFromWater` | Минимальное расстояние от воды для спавна ящика (не используется при ручном размещении локаций) |
| `MaxSlopeAngle` | Максимальный угол наклона поверхности для спавна ящика (не используется при ручном размещении локаций) |
| `NoBuildsAroundEventBoxRadius` | Радиус запрета строительства вокруг активного ящика события |

### Сообщения

```xml
<EventMessage>{0} появился на карте! Редкость: {1}. Рядом с локацией: {2}. Будь первым, кто его откроет!</EventMessage>
<EventTimerMessage>До открытия ящика осталось {0} секунд!</EventTimerMessage>
<EventActivatedMessage>Игрок {0} активировал {1} ящик! Осталось {2} секунд до открытия.</EventActivatedMessage>
<EventBoxLockedMessage>Ящик активирован! Подождите {0} секунд до полного открытия.</EventBoxLockedMessage>
<EventCompletedMessage>Ящик открыт и наполнен лутом! Теперь в этой зоне можно строить.</EventCompletedMessage>
<NoBuildingNearEventMessage>Нельзя строить рядом с активным ивентом до его завершения!</NoBuildingNearEventMessage>
```

| Параметр | Описание | Заполнители |
|----------|----------|-------------|
| `EventMessage` | Сообщение о создании нового ящика | `{0}` - название ящика, `{1}` - редкость, `{2}` - местоположение |
| `EventTimerMessage` | Сообщение таймера обратного отсчета | `{0}` - оставшееся время в секундах |
| `EventActivatedMessage` | Сообщение при активации ящика игроком | `{0}` - имя игрока, `{1}` - название ящика, `{2}` - время до открытия |
| `EventBoxLockedMessage` | Сообщение при попытке открыть активированный ящик | `{0}` - оставшееся время в секундах |
| `EventCompletedMessage` | Сообщение о завершении события |  |
| `NoBuildingNearEventMessage` | Сообщение при попытке строительства рядом с ящиком |  |

### Ящики событий

```xml
<EventBoxes>
  <EventBox Id="1" Name="Обычный ящик" Rarity="Common" Weight="60" BarricadeId="1372">
    <Items>
      <Item Id="16" Chance="80" Min="1" Max="2" />
      <Item Id="17" Chance="70" Min="1" Max="3" />
      <!-- ... другие предметы ... -->
    </Items>
  </EventBox>
  <!-- ... другие типы ящиков ... -->
</EventBoxes>
```

| Параметр | Описание |
|----------|----------|
| `Id` | Уникальный идентификатор ящика (число) |
| `Name` | Отображаемое название ящика |
| `Rarity` | Редкость ящика (влияет на цвет в сообщениях) |
| `Weight` | Вес/шанс выпадения этого ящика относительно других ящиков |
| `BarricadeId` | ID баррикады, используемой для ящика (должен быть существующий ID Storage) |

#### Предметы в ящике:

```xml
<Item Id="16" Chance="80" Min="1" Max="2" />
```

| Параметр | Описание |
|----------|----------|
| `Id` | ID предмета в Unturned |
| `Chance` | Шанс появления предмета в ящике (от 1 до 100) |
| `Min` | Минимальное количество предмета |
| `Max` | Максимальное количество предмета |

### Локации событий

```xml
<EventLocations>
  <Location Id="1" Name="Стандартная локация">
    <Position>
      <x>500</x>
      <y>100</y>
      <z>500</z>
    </Position>
  </Location>
  <!-- ... другие локации ... -->
</EventLocations>
```

| Параметр | Описание |
|----------|----------|
| `Id` | Уникальный идентификатор локации (число) |
| `Name` | Название локации (отображается в сообщениях) |
| `Position` | Координаты точки спавна ящика (Vector3) |

### Цвета редкости

```xml
<RarityColors>
  <Color Type="Common" Hex="#AAAAAA" />
  <Color Type="Uncommon" Hex="#55AA55" />
  <!-- ... другие цвета ... -->
</RarityColors>
```

| Параметр | Описание |
|----------|----------|
| `Type` | Тип редкости (соответствует Rarity в EventBox) |
| `Hex` | HEX-код цвета для отображения в сообщениях |

## Команды плагина

### События
| Команда | Описание | Разрешение |
|---------|----------|------------|
| `/event start <тип>` | Принудительно запускает событие указанного типа | `events.admin` |
| `/event stop` | Останавливает все активные события | `events.admin` |
| `/event list` | Показывает список активных событий | `events.admin` |

### Локации
| Команда | Описание | Разрешение |
|---------|----------|------------|
| `/eventlocation add <имя>` | Добавляет текущую позицию игрока как локацию для ивента | `events.admin` |
| `/eventlocation remove <id>` | Удаляет локацию с указанным ID | `events.admin` |
| `/eventlocation list` | Показывает список всех доступных локаций | `events.admin` |

## Механика работы

1. **Запуск события**:
   - Событие запускается автоматически каждые `EventIntervalMinutes` минут.
   - Для запуска требуется минимальное количество игроков (`MinPlayersForEvent`).
   - Случайно выбирается тип ящика (на основе значений `Weight`).
   - Случайно выбирается локация из списка `EventLocations`.

2. **Уведомление игроков**:
   - Все игроки получают сообщение о начале события.
   - На карте устанавливается маркер с координатами ящика.

3. **Активация ящика**:
   - Первый игрок, взаимодействующий с ящиком, активирует его.
   - Начинается обратный отсчет (`CountdownTimerSeconds`).
   - Во время обратного отсчета, ящик нельзя открыть.

4. **Завершение события**:
   - По окончании обратного отсчета, ящик заполняется предметами из конфигурации.
   - Предметы генерируются с учетом их шансов и количества.
   - Теперь игроки могут открыть ящик и забрать лут.
   - Ящик исчезает через 10 секунд после завершения отсчета.

5. **Защита от строительства**:
   - Во время активного события, в радиусе `NoBuildsAroundEventBoxRadius` от ящика нельзя строить.
   - После завершения события ограничение снимается.

## Примеры использования

### Пример 1: Добавление новой локации для события

1. Перейдите в желаемую точку на карте, где хотите создать локацию
2. Выполните команду: `/eventlocation add Военная база`
3. Система добавит текущую позицию в список локаций и сохранит её в конфигурации

### Пример 2: Настройка нового типа ящика

```xml
<EventBox Id="4" Name="Легендарный ящик" Rarity="Legendary" Weight="5" BarricadeId="1372">
  <Items>
    <Item Id="1382" Chance="50" Min="1" Max="1" /> <!-- Драгунов -->
    <Item Id="1193" Chance="60" Min="1" Max="2" /> <!-- Магазин для Драгунова -->
    <Item Id="44" Chance="70" Min="20" Max="40" /> <!-- Патроны 7.62мм -->
    <Item Id="1185" Chance="30" Min="1" Max="1" /> <!-- Тактический прицел -->
  </Items>
</EventBox>
```

### Пример 3: Принудительный запуск события

Выполните команду: `/event start box`

## Устранение проблем

**Проблема**: События не запускаются автоматически
**Решение**: Проверьте значение `IsEnabled` в конфигурации, убедитесь что на сервере достаточно игроков (больше чем `MinPlayersForEvent`)

**Проблема**: Ящики спавнятся в неподходящих местах
**Решение**: Используйте команду `/eventlocation add` чтобы вручную добавить подходящие локации и удалите автоматически сгенерированные

**Проблема**: В ящике не появляются предметы
**Решение**: Проверьте правильность ID предметов в конфигурации. Убедитесь, что шансы выпадения (Chance) достаточно высокие.

**Проблема**: Ящик не отображается при запуске события
**Решение**: Убедитесь, что ID баррикады (`BarricadeId`) соответствует существующему объекту хранения (Storage) в игре
